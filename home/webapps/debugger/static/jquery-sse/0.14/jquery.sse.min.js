!function($){function n(n){n.type="event",n.instance=new EventSource(n._url),n.instance.successCount=0,n.instance.onmessage=n._settings.onMessage,n.instance.onopen=function(e){0===n.instance.successCount++&&n._settings.onOpen(e)},n.instance.onerror=function(e){e.target.readyState===EventSource.CLOSED&&n._settings.onError(e)};for(var e in n._settings.events)n.instance.addEventListener(e,n._settings.events[e],!1)}function e(n){n.type="ajax",n.instance={successCount:0,id:null,retry:3e3,data:"",event:""},t(n)}function t(n){if(n.instance){var e={"Last-Event-ID":n.instance.id};$.extend(e,n._settings.headers),$.ajax({url:n._url,method:"GET",headers:e,success:function(e,s,i){if(n.instance){0===n.instance.successCount++&&n._settings.onOpen();var a=e.split("\n");n.instance.data="";var r=0;for(var c in a){var o=a[c].indexOf(":"),u=[a[c].substr(0,o),a[c].substr(o+1)];switch(u[0]){case"":u[1]||1!==r++||(eventMessage={data:n.instance.data,lastEventId:n.instance.id,origin:"http://"+i.getResponseHeader("Host"),returnValue:!0},n.instance.event&&n._settings.events[n.instance.event]?n._settings.events[n.instance.event](eventMessage):n._settings.onMessage(eventMessage),n.instance.data="",n.instance.event="",r=0);break;case"retry":r=0,n.instance.retry=parseInt(u[1].trim());break;case"id":r=0,n.instance.id=u[1].trim();break;case"event":r=0,n.instance.event=u[1].trim();break;case"data":r=0,n.instance.data+=(""!==n.instance.data?"\n":"")+u[1].trim();break;default:r=0}}setTimeout(function(){t(n)},n.instance.retry)}},error:n._settings.onError})}}$.extend({SSE:function(t,s){var i={instance:null,type:null},a={onOpen:function(n){},onEnd:function(n){},onError:function(n){},onMessage:function(n){},options:{},headers:{},events:{}};return $.extend(a,s),i._url=t,i._settings=a,i._start=i.start,i.start=function(){return this.instance?!1:(!window.EventSource||this._settings.options.forceAjax||Object.keys(this._settings.headers).length>0?e(this):n(this),!0)},i.stop=function(){return this.instance?(!window.EventSource||this._settings.options.forceAjax||Object.keys(this._settings.headers).length>0||this.instance.close(),this._settings.onEnd(),this.instance=null,this.type=null,!0):!1},i}})}(jQuery);